name: Debug Discord Notifications

on:
  push:
    branches: [ main ]

jobs:
  debug:
    runs-on: ubuntu-latest
    env:
      DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}

    steps:
      - name: Environment Check
        run: |
          echo "=== í™˜ê²½ ë³€ìˆ˜ ì²´í¬ ==="
          echo "DISCORD_WEBHOOK_URL ì„¤ì •ë¨: $([[ -n $DISCORD_WEBHOOK_URL ]] && echo 'âœ…' || echo 'âŒ')"
          echo "URL ê¸¸ì´: ${#DISCORD_WEBHOOK_URL}"
          echo "URL í˜•ì‹: ${DISCORD_WEBHOOK_URL:0:30}..."
          
      - name: Simple Test Message
        run: |
          echo "=== ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ==="
          
          curl -v \
            -H "Content-Type: application/json" \
            -X POST \
            -d '{"content": "ğŸš¨ **ê¸´ê¸‰ í…ŒìŠ¤íŠ¸**: ì´ ë©”ì‹œì§€ê°€ ë³´ì´ë‚˜ìš”?"}' \
            "$DISCORD_WEBHOOK_URL"
            
      - name: Test with jq
        run: |
          echo "=== jqë¥¼ ì‚¬ìš©í•œ í…ŒìŠ¤íŠ¸ ==="
          
          MESSAGE="ğŸ“‹ **jq í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€**
          â° ì‹œê°„: $(date)
          ğŸ”§ ì›Œí¬í”Œë¡œìš°: ${{ github.workflow }}"
          
          payload=$(jq -n --arg content "$MESSAGE" '{"content": $content}')
          echo "ìƒì„±ëœ payload:"
          echo "$payload"
          
          curl -v \
            -H "Content-Type: application/json" \
            -X POST \
            -d "$payload" \
            "$DISCORD_WEBHOOK_URL"
